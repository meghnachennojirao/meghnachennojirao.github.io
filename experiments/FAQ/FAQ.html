<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ - Frequently Asked Questions</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Material Design Colors -->
    <style>
        :root {
            /* Core colors using HSL */
            --primary-hue: 265;
            --secondary-hue: 175;
            
            /* Primary palette */
            --primary-color: hsla(var(--primary-hue), 100%, 46%, 1);
            --primary-light: hsla(var(--primary-hue), 75%, 76%, 1);
            --primary-dark: hsla(var(--primary-hue), 100%, 35%, 1);
            --primary-transparent: hsla(var(--primary-hue), 100%, 46%, 0.1);
            
            /* Secondary palette */
            --secondary-color: hsla(var(--secondary-hue), 100%, 44%, 1);
            --secondary-light: hsla(var(--secondary-hue), 75%, 65%, 1);
            --secondary-dark: hsla(var(--secondary-hue), 100%, 27%, 1);
            --secondary-transparent: hsla(var(--secondary-hue), 100%, 44%, 0.1);
            
            /* Text hierarchy */
            --text-heading: rgba(25, 25, 35, 0.95);
            --text-subheading: rgba(40, 40, 50, 0.9);
            --text-body: rgba(60, 60, 70, 0.85);
            --text-muted: rgba(100, 100, 110, 0.7);
            
            /* Base colors */
            --surface-color: rgba(255, 255, 255, 0.9);
            --background-color: #f0f2f5;
            --text-primary: var(--text-heading);
            --text-secondary: var(--text-body);
            --error-color: #b00020;
    
            /* Glass morphism */
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --glass-blur: 10px;
            
            /* Neomorphism */
            --neo-bg: #f0f0f3;
            --neo-shadow-light: rgba(255, 255, 255, 0.9);
            --neo-shadow-dark: rgba(0, 0, 0, 0.1);
        }
    
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-body);
            line-height: 1.6;
            background-image: 
                linear-gradient(135deg, 
                    hsla(var(--primary-hue), 100%, 96%, 0.5),
                    hsla(var(--secondary-hue), 100%, 96%, 0.5)
                );
            background-attachment: fixed;
        }
    
        /* Typography hierarchy */
        h1, h2 {
            color: var(--text-heading);
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        h3, h4 {
            color: var(--text-subheading);
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        h5, h6 {
            color: var(--text-body);
            font-weight: 500;
        }
        
        .text-muted {
            color: var(--text-muted) !important;
        }
    
        .header {
            background: linear-gradient(135deg, 
                hsla(var(--primary-hue), 100%, 46%, 0.85), 
                hsla(var(--primary-hue), 75%, 76%, 0.75)
            );
            color: white;
            padding: 3rem 0;
            margin-bottom: 2.5rem;
            border-radius: 0 0 30px 30px;
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-bottom: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }
        
        .header h1 {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    
        /* Glass morphism card */
        .card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
    
        .card:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .card-title {
            color: var(--text-subheading);
            font-weight: 600;
            margin-bottom: 1rem;
        }
    
        /* Neomorphic buttons */
        .btn-primary {
            background: linear-gradient(145deg, 
                hsla(var(--primary-hue), 100%, 50%, 1), 
                hsla(var(--primary-hue), 100%, 40%, 1)
            );
            border: none;
            border-radius: 25px;
            padding: 0.8rem 2rem;
            font-weight: 500;
            box-shadow: 
                5px 5px 10px var(--neo-shadow-dark),
                -5px -5px 10px var(--neo-shadow-light);
            transition: all 0.3s ease;
            color: white;
        }
    
        .btn-primary:hover {
            background: linear-gradient(145deg, 
                hsla(var(--primary-hue), 90%, 55%, 1), 
                hsla(var(--primary-hue), 90%, 45%, 1)
            );
            transform: translateY(-2px);
            box-shadow: 
                8px 8px 16px var(--neo-shadow-dark),
                -8px -8px 16px var(--neo-shadow-light);
        }
    
        .btn-primary:active {
            background: linear-gradient(145deg, 
                hsla(var(--primary-hue), 80%, 40%, 1), 
                hsla(var(--primary-hue), 80%, 50%, 1)
            );
            transform: translateY(1px);
            box-shadow: inset 
                4px 4px 8px var(--neo-shadow-dark),
                inset -4px -4px 8px var(--neo-shadow-light);
        }
    
        /* Neomorphic navigation pills */
        .nav-pills .nav-link {
            color: var(--text-body);
            border-radius: 25px;
            padding: 0.8rem 1.8rem;
            margin: 0 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background: var(--neo-bg);
            box-shadow: 
                4px 4px 8px var(--neo-shadow-dark),
                -4px -4px 8px var(--neo-shadow-light);
        }
    
        .nav-pills .nav-link:hover {
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 
                6px 6px 12px var(--neo-shadow-dark),
                -6px -6px 12px var(--neo-shadow-light);
        }
    
        .nav-pills .nav-link.active {
            background: linear-gradient(145deg, 
                hsla(var(--primary-hue), 100%, 50%, 1), 
                hsla(var(--primary-hue), 100%, 40%, 1)
            );
            color: white;
            box-shadow: 0 4px 15px hsla(var(--primary-hue), 100%, 46%, 0.3);
        }
    
        /* Enhanced form elements */
        .form-select, .form-control {
            background-color: var(--neo-bg);
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
            border: none;
            transition: all 0.3s ease;
            box-shadow: inset 
                2px 2px 5px var(--neo-shadow-dark),
                inset -2px -2px 5px var(--neo-shadow-light);
            color: var(--text-body);
        }
    
        .form-select:focus, .form-control:focus {
            box-shadow: 
                0 0 0 3px hsla(var(--primary-hue), 100%, 46%, 0.25),
                inset 2px 2px 5px var(--neo-shadow-dark),
                inset -2px -2px 5px var(--neo-shadow-light);
            border: none;
            outline: none;
        }
        
        .form-label {
            color: var(--text-subheading);
            font-weight: 500;
            margin-bottom: 0.75rem;
        }
    
        /* Card variations */
        .question-card, .topic-card {
            cursor: pointer;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.7),
                rgba(255, 255, 255, 0.5)
            );
        }
    
        .question-card:hover {
            border-left: 4px solid var(--secondary-color);
            background: linear-gradient(
                135deg,
                hsla(var(--primary-hue), 50%, 97%, 0.8),
                hsla(var(--secondary-hue), 50%, 97%, 0.8)
            );
        }
    
        .metadata {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.6),
                rgba(255, 255, 255, 0.4)
            );
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-radius: 15px;
            padding: 1.2rem;
            margin-top: 1rem;
            border: 1px solid var(--glass-border);
        }
        
        .metadata h6 {
            color: var(--text-subheading);
            font-weight: 600;
        }
    
        /* Badges with glassmorphism */
        .marks-badge {
            display: inline-block;
            background: linear-gradient(
                135deg,
                hsla(var(--primary-hue), 80%, 65%, 0.9),
                hsla(var(--primary-hue), 80%, 55%, 0.9)
            );
            color: white;
            font-size: 0.8rem;
            padding: 0.2rem 0.8rem;
            border-radius: 12px;
            margin-left: 8px;
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .frequency-badge {
            background: linear-gradient(
                135deg,
                hsla(var(--secondary-hue), 80%, 65%, 0.9),
                hsla(var(--secondary-hue), 80%, 55%, 0.9)
            );
            color: white;
            font-size: 0.75rem;
            padding: 0.15rem 0.7rem;
            border-radius: 12px;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Neomorphic checkboxes */
        .form-check-input {
            cursor: pointer;
            width: 1.3em;
            height: 1.3em;
            border: none;
            background-color: var(--neo-bg);
            box-shadow: 
                inset 2px 2px 5px var(--neo-shadow-dark),
                inset -2px -2px 5px var(--neo-shadow-light);
            border-radius: 50%;
            transition: all 0.3s ease;
            position: relative;
            appearance: none;
            -webkit-appearance: none;
        }
    
        .form-check-input:checked {
            background: linear-gradient(145deg, 
                hsla(var(--primary-hue), 100%, 50%, 1), 
                hsla(var(--primary-hue), 100%, 40%, 1)
            );
            box-shadow: 0 0 0 2px var(--neo-bg), 
                       0 0 0 4px hsla(var(--primary-hue), 100%, 46%, 0.5);
        }
        
        .form-check-input:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Section headers */
        .tab-pane h3 {
            position: relative;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            display: inline-block;
        }
        
        .tab-pane h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(
                90deg,
                var(--primary-color),
                var(--secondary-color)
            );
            border-radius: 3px;
        }
        
        /* Alert glassmorphism */
        .alert {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 15px;
        }
        
        .alert-info {
            background: linear-gradient(
                135deg,
                hsla(var(--primary-hue), 50%, 97%, 0.8),
                hsla(var(--primary-hue), 50%, 93%, 0.8)
            );
            border-left: 4px solid var(--primary-color);
        }
        
        .alert-warning {
            background: linear-gradient(
                135deg,
                hsla(40, 100%, 97%, 0.8),
                hsla(40, 100%, 93%, 0.8)
            );
            border-left: 4px solid hsl(40, 100%, 50%);
        }
        
        /* Expand buttons */
        .expand-button {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--neo-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-muted);
            transition: all 0.3s ease;
            box-shadow: 
                3px 3px 6px var(--neo-shadow-dark),
                -3px -3px 6px var(--neo-shadow-light);
            margin-top: 0.75rem;
        }
        
        .expand-button:hover {
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 
                4px 4px 8px var(--neo-shadow-dark),
                -4px -4px 8px var(--neo-shadow-light);
        }
        
        .expand-button:active {
            transform: translateY(1px);
            box-shadow: inset 
                2px 2px 4px var(--neo-shadow-dark),
                inset -2px -2px 4px var(--neo-shadow-light);
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3H9JR6P5Z0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-3H9JR6P5Z0');
    </script>
</head>
<body>

<div class="header">
    <div class="container">
        <h1 class="text-center">
            <i class="fas fa-question-circle me-2"></i>
            FAQ
        </h1>
        <div class="text-center mb-4">
            <p class="text-center text-muted">
                <span>Compiled by</span>
                <a href="https://meghnachennojirao.github.io" target="_blank" class="text-decoration-none" style="color: black"
                >meghnachennojirao.github.io</a> 
            </p>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <div class="form-group">
                <label for="subject-select" class="form-label">
                    <i class="fas fa-book me-2"></i>Select Subject
                </label>
                <select id="subject-select" class="form-select">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
        </div>
    </div>

    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <ul class="nav nav-pills justify-content-center" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="pill" href="#popular-questions">
                        <i class="fas fa-star me-2"></i>Popular Questions
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#popular-topics">
                        <i class="fas fa-list me-2"></i>Popular Topics
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#all-questions">
                        <i class="fas fa-th-list me-2"></i>All Questions
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="pill" href="#mock-test">
                        <i class="fas fa-file-alt me-2"></i>Mock Test
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="tab-content">
        <div id="popular-questions" class="tab-pane fade show active">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div id="popular-questions-list"></div>
                </div>
            </div>
        </div>

        <div id="popular-topics" class="tab-pane fade">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div id="popular-topics-list"></div>
                </div>
            </div>
        </div>

        <div id="all-questions" class="tab-pane fade">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div>
                        <label for="toggle-sort" class="form-check-label pb-4">
                            <i class="fas fa-sort me-2"></i>Sort by Marks
                        </label>
                        <input type="checkbox" id="toggle-sort" class="form-check-input" onchange="updateAllSections(globalData)">
                    </div>
                        
                        
                    <div id="all-questions-list"></div>
                </div>
            </div>
        </div>

        <div id="mock-test" class="tab-pane fade">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4><i class="fas fa-cog me-2"></i>Test Configuration</h4>
                            <div class="form-group mb-3">
                                <label for="max-marks" class="form-label">Approximate Maximum Marks</label>
                                <input type="number" id="max-marks" class="form-control" value="100" min="20" max="200">
                            </div>
                            <button class="btn btn-primary" onclick="generateMockTest()">
                                <i class="fas fa-random me-2"></i>Generate Test
                            </button>
                        </div>
                    </div>
                    <div id="mock-test-paper" class="card">
                        <div class="card-body">
                            <div id="test-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<script>
// Fetch JSON data from the same folder
// Add at the start of script section
let globalData = []; // Store the original data

// Update the fetch handler
fetch('new_data.json')
    .then(response => response.json())
    .then(data => {

        // go through every entry and if main_exam_subject is "General Biochemistry" then change it to "Biochemistry"
        // and if main_exam_subject is "Molecular Biology" then change it to "Cell and Molecular Biology"
        for (let i = 0; i < data.length; i++) {
            if (data[i].main_exam_subject === "General Biochemistry") {
                data[i].main_exam_subject = "Biochemistry";
            }
            if (data[i].main_exam_subject === "Molecular Biology") {
                data[i].main_exam_subject = "Cell and Molecular Biology";
            }
        }


        
        globalData = data; // Store data globally
        populateSubjectDropdown(data);
        updateAllSections(data);
    })
    .catch(error => console.error("Error loading JSON data:", error));

// Add new function to handle updates
function updateAllSections(data) {
    // Clear existing content
    document.getElementById('popular-questions-list').innerHTML = '';
    document.getElementById('popular-topics-list').innerHTML = '';
    document.getElementById('all-questions-list').innerHTML = '';
    
    // Regenerate all sections
    generatePopularQuestions(data);
    generatePopularTopics(data);
    generateAllQuestions(data);
}

// Function to display the correct section
function showSection(sectionId) {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => section.classList.remove('active'));

    const buttons = document.querySelectorAll('.tab-button');
    buttons.forEach(button => button.classList.remove('active'));

    document.getElementById(sectionId).classList.add('active');
    const activeButton = Array.from(buttons).find(button => button.innerText.toLowerCase().replace(/\s+/g, '-') === sectionId);
    activeButton.classList.add('active');
}



// Update subject dropdown handler
function populateSubjectDropdown(data) {
    const dropdown = document.getElementById('subject-select');
    const subjects = [...new Set(data.map(item => item.main_exam_subject))];
    
    // Add "All Subjects" option
    const allOption = document.createElement('option');
    allOption.value = '';
    allOption.textContent = 'All Subjects';
    dropdown.appendChild(allOption);

    subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        dropdown.appendChild(option);
    });

    // Add change event listener
    dropdown.addEventListener('change', () => {
        const selectedSubject = dropdown.value;
        const filteredData = selectedSubject ? 
            globalData.filter(item => item.main_exam_subject === selectedSubject) : 
            globalData;
        updateAllSections(filteredData);
    });
}

// Function to generate Most Popular Questions
function generatePopularQuestions(data) {
    const container = document.getElementById('popular-questions-list');
    const groupedByMarks = {};
    const checkedQuestions = getCheckedQuestions();

    // Group questions by marks
    data.forEach(item => {
        if (!groupedByMarks[item.marks]) {
            groupedByMarks[item.marks] = [];
        }
        groupedByMarks[item.marks].push(item);
    });

    // Sort by marks (ascending order)
    const sortedMarks = Object.keys(groupedByMarks).sort((a, b) => b - a);

    // Render questions for each marks section
    sortedMarks.forEach(marks => {
        const section = document.createElement('div');
        section.innerHTML = `<h3>Marks: ${marks}</h3>`;

        // sort by frequency
        groupedByMarks[marks].sort((a, b) => b.reference.length - a.reference.length);

        groupedByMarks[marks].slice(0, 20).forEach(question => {

            const questionId = `${question.question.substring(0, 50)}_${question.marks}`;
            const isChecked = checkedQuestions[questionId] || false;
            
            const questionElement = document.createElement('div');
            questionElement.classList.add('question');
            questionElement.innerHTML = `
                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="card-title">
                                <input type="checkbox" 
                                    class="form-check-input question-checkbox m-2 mt-0" 
                                    id="${questionId}"
                                    ${isChecked ? 'checked' : ''}
                                    onchange="setQuestionChecked('${questionId}', this.checked)">
                            ${question.question}<span style="color: var(--primary-color); font-size: 0.8rem;"><i class="fas fa-star ms-2 pl-5"></i> ${question.reference.length}</span>
                        </h5>
                        <div class="expand-button" onclick="toggleMetadata(this)">
                            <i class="fas fa-chevron-down me-1"></i>Show Details
                        </div>
                        <div class="metadata d-none">
                            <h6><i class="fas fa-book me-2"></i>References:</h6>
                            <ul class="list-unstyled">
                                ${question.reference.map(ref => `
                                    <li><i class="fas fa-bookmark me-2"></i>${ref[0]} (${ref[1]} ${ref[2]})</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            section.appendChild(questionElement);
        });

        container.appendChild(section);
    });
}

// Function to generate Most Popular Topics
function generatePopularTopics(data) {
    const container = document.getElementById('popular-topics-list');
    const topicMarks = {};

    // Group questions by topic and add marks
    data.forEach(item => {
        if (!topicMarks[item.topic]) {
            topicMarks[item.topic] = { totalMarks: 0, questions: [] };
        }
        topicMarks[item.topic].totalMarks += item.marks;
        topicMarks[item.topic].questions.push(item);
    });

    // Sort topics by total marks
    const sortedTopics = Object.entries(topicMarks).sort((a, b) => b[1].totalMarks - a[1].totalMarks);

    // Render topics and their questions
    sortedTopics.slice(0, 30).forEach(([topic, { totalMarks, questions }]) => {
        const topicElement = document.createElement('div');
        topicElement.classList.add('topic');
        topicElement.innerHTML = `
            <strong>${topic}</strong> - Total Marks: ${totalMarks}
            <div class="expand" onclick="toggleTopicDetails(this)">
                <i class="fas fa-chevron-${questions.length > 5 ? 'down' : 'up'} me-1"></i>Has  ${questions.length} Questions
            </div>
            <div class="metadata">
                <h4>Top 5 Questions</h4>
                <ul>
                    ${questions.slice(0, 5).map(q => `<li>${q.question}</li>`).join('')}
                </ul>
            </div>
        `;
        container.appendChild(topicElement);
    });
}

// Functions to manage localStorage
function getCheckedQuestions() {
    const checked = localStorage.getItem('checkedQuestions');
    return checked ? JSON.parse(checked) : {};
}

function setQuestionChecked(questionId, isChecked) {
    const checked = getCheckedQuestions();
    checked[questionId] = isChecked;
    localStorage.setItem('checkedQuestions', JSON.stringify(checked));
}



// Function to generate All Questions
function generateAllQuestions(data) {
    const container = document.getElementById('all-questions-list');
    const checkedQuestions = getCheckedQuestions();

    // Sort questions by frequency (number of references) or marks depending on the toggle selected
    const toggleType = document.getElementById('toggle-sort').checked ? 'marks' : 'frequency';
    
    if (toggleType === 'frequency') {
        var sortedQuestions = data.sort((a, b) => b.reference.length - a.reference.length);
    } else {
        var sortedQuestions = data.sort((a, b) => b.marks - a.marks);
    }
    // const sortedQuestions = data.sort((a, b) => (b.reference.length * b.marks) - (a.reference.length * a.marks));

    // Render all questions
    sortedQuestions.forEach(question => {

        const questionId = `${question.question.substring(0, 50)}_${question.marks}`;
        const isChecked = checkedQuestions[questionId] || false;


        const questionElement = document.createElement('div');
        questionElement.classList.add('question');
        questionElement.innerHTML = `
            <div class="d-flex align-items-start mb-2">
                <div class="form-check me-2">
                    <input type="checkbox" 
                        class="form-check-input question-checkbox" 
                        id="${questionId}"
                        ${isChecked ? 'checked' : ''}
                        onchange="setQuestionChecked('${questionId}', this.checked)">
                </div>
                <div>
                    <strong>${question.question}</strong> 
                    (${question.marks} marks, ${question.reference.length} references)
                </div>
            </div>
        `;

        // Add references
        const references = document.createElement('span');
        question.reference.forEach(ref => {
            const reference = document.createElement('span');
            reference.innerHTML = `
                (${ref[1]} ${ref[2]})
            `;
            references.appendChild(reference);
        });
        questionElement.appendChild(references);

        // add class mb-4
        questionElement.classList.add('mb-4');


        container.appendChild(questionElement);
    });
}

function toggleMetadata(element) {
    const metadata = element.nextElementSibling;
    metadata.classList.toggle('d-none');
    const icon = element.querySelector('i');
    icon.classList.toggle('fa-chevron-down');
    icon.classList.toggle('fa-chevron-up');
}

// Toggle topic details visibility
function toggleTopicDetails(element) {
    const metadata = element.nextElementSibling;
    metadata.style.display = metadata.style.display === 'block' ? 'none' : 'block';
}

function generateRandomPrimaryColor() {
    const allowedHues = [40, 198, 270, 300]; // Allowed hues for the primary color
    const hue = allowedHues[Math.floor(Math.random() * allowedHues.length)];
    const primary = `hsl(${hue}, 100%, 47%)`;
    const primaryLight = `hsl(${hue}, 100%, 76%)`;
    
    document.documentElement.style.setProperty('--primary-color', primary);
    document.documentElement.style.setProperty('--primary-light', primaryLight);

    document.documentElement.style.setProperty('--primary-hue', hue);
    document.documentElement.style.setProperty('--primary-hue-light', hue + 20);
    document.documentElement.style.setProperty('--primary-hue-dark', hue - 20);
}

// Call the function to generate a random primary color
generateRandomPrimaryColor();




function getRandomQuestions(data, count, marks) {
    // Filter questions by marks
    const eligibleQuestions = data.filter(q => q.marks === marks);
    
    // Shuffle and pick required number of questions
    return shuffleArray(eligibleQuestions).slice(0, count);
}

function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}


function getAvailableMarks(data, subject) {
    // Get unique mark values from filtered data
    const filteredData = subject ? 
        data.filter(item => item.main_exam_subject === subject) : 
        data;
    return [...new Set(filteredData.map(q => q.marks))].sort((a,b) => a-b);
}

function determineSections(availableMarks) {
    // Categorize marks into short, medium and long answer sections
    const short = availableMarks.filter(m => m <= 3);
    const medium = availableMarks.filter(m => m > 3 && m <= 8);
    const long = availableMarks.filter(m => m > 8);

    return [
        { name: 'Section A - Short Answer Questions', marks: short[0] || null, percent: 0.3 },
        { name: 'Section B - Medium Answer Questions', marks: medium[0] || null, percent: 0.4 },
        { name: 'Section C - Long Answer Questions', marks: long[0] || null, percent: 0.3 }
    ].filter(section => section.marks !== null);
}

// Replace existing generateMockTest() with this version
function generateMockTest() {
    const maxMarks = parseInt(document.getElementById('max-marks').value);
    const selectedSubject = document.getElementById('subject-select').value;
    const testContent = document.getElementById('test-content');
    testContent.innerHTML = '';

    const availableMarks = getAvailableMarks(globalData, selectedSubject);
    const sections = determineSections(availableMarks);

    if (sections.length === 0) {
        testContent.innerHTML = '<div class="alert alert-warning">No questions available for selected criteria</div>';
        return;
    }

    var checkedQuestions = getCheckedQuestions();

    // Adjust percentages based on available sections
    const percentPerSection = 1 / sections.length;
    sections.forEach(section => section.percent = percentPerSection);

    sections.forEach(section => {
        const sectionMarks = Math.floor(maxMarks * section.percent);
        const numQuestions = Math.floor(sectionMarks / section.marks);
        
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'mb-4';
        sectionDiv.innerHTML = `
            <h3 class="mb-3">${section.name}</h3>
            <p class="text-muted">Answer any ${numQuestions} questions. Each question carries ${section.marks} marks.</p>
        `;

        // Get random questions for this section
        const questions = getRandomQuestions(
            selectedSubject ? globalData.filter(q => q.main_exam_subject === selectedSubject) : globalData,
            numQuestions, 
            section.marks
        );
        
        const questionList = document.createElement('ol');
        questions.forEach(q => {

            const questionId = `${q.question.substring(0, 50)}_${q.marks}`;
            const isChecked = checkedQuestions[questionId] || false;
            

            const li = document.createElement('li');
            li.className = 'mb-3';
            li.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <div>
                            <input type="checkbox" 
                                        class="form-check-input question-checkbox mr-3" 
                                        id="${questionId}"
                                        ${isChecked ? 'checked' : ''}
                                        onchange="setQuestionChecked('${questionId}', this.checked)">
                            <span class="mb-2 ml-2 pl-3">${q.question}</span>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-bookmark me-1"></i>
                            Topic: ${q.topic}
                            ${selectedSubject ? '' : `<br>Subject: ${q.main_exam_subject}`}
                        </small>
                    </div>
                </div>
            `;
            questionList.appendChild(li);
        });

        sectionDiv.appendChild(questionList);
        testContent.appendChild(sectionDiv);
    });

    // Add summary of mark distribution
    const summaryDiv = document.createElement('div');
    summaryDiv.className = 'alert alert-info mt-3';
    summaryDiv.innerHTML = `
        <h4>Mark Distribution</h4>
        ${sections.map(s => 
            `${s.name}: ${Math.floor(maxMarks * s.percent)} marks (${s.marks} marks × ${Math.floor((maxMarks * s.percent)/s.marks)} questions)`
        ).join('<br>')}
    `;
    testContent.insertBefore(summaryDiv, testContent.firstChild);
}


</script>

</body>
</html>
