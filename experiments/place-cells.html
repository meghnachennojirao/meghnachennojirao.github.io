<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Place Cells Game</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta charset="UTF-8">
        <meta name="description" content="A game about Place Cells">
        <meta name="keywords" content="plots.js, Dr Meghna Rao, prajwalsouza, Prajwal DSouza">
        <meta name="author" content="Dr. Meghna Rao, Prajwal DSouza">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:title" content="Where is the Parabola? - The Universal Parabolic Constant Mystery" />
        <meta property="og:description" content="A game about Place Cells" />
        <meta property="og:image" content="https://meghnachennojirao.github.io/assets/images/blog/pexels-pixabay-355887.jpg" />
        <meta property="og:url" content="https://meghnachennojirao.github.io/experiments/place-cells">
        <meta property="og:type" content="game, educational game" />


		<link href="https://fonts.googleapis.com/css?family=Nunito&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Raleway:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

		<!-- Some times used library for icons -->
		<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/prajwalsouza/IgnusTheme@1.3/ignus-theme.css">
        <script src="https://cdn.jsdelivr.net/gh/prajwalsouza/IgnusTheme@1.3/ignus-theme.js"></script>


		<link rel="icon" href="square.png">
		
		<script type="application/ld+json">
			{
			  "@type": "blog",
			  "name": "Place Cells Game",
			  "author": "Dr. Meghna Rao, Prajwal DSouza",
			  "description": "A game about Place Cells"
			  }
		</script>

        <!-- <link rel="stylesheet" href="/css/universal-parabolic-constant/universal-parabolic-constant.css"/> -->

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-3H9JR6P5Z0"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
    
            gtag('config', 'G-3H9JR6P5Z0');
        </script>
      

	</head>
	<body style='margin:0px; display: block;'>
		<div id="containAll" class="p-sm-3 p-1" style=" overflow: hidden; ">
            <div style="border: 1px solid hsla(0,0%,0%, 0); border-radius: 10px; background: hsla(0, 0%, 6%, 1); ">
                
                <header id="upc-header" class="pr-2 pr-sm-3" style="position: fixed;font-family: Raleway; overflow: hidden; width: calc(100%); top: 0; z-index: 3; opacity: 0; pointer-events: none;" onclick="placeCellsGame.headerClick()">
                    <div style="background-image: linear-gradient(to bottom, hsla(0, 0%, 6%, 1),hsla(0, 0%, 6%, 1), transparent);color: hsl(0,0%,20%);font-size: small;min-height: 131px;" class="text-ignus p-4 pl-5 pr-5 p-md-3 pl-md-4 pr-md-4 text-md-left text-center">
                        <span style="cursor: pointer;"> 
                            <span style="font-size:x-small;">Neuro Navigator</span>
                        </span>
                        <br/>
                    </div>
                    
                </header>

                <main>
                    <div class="p-4 pl-5 text-ignus text-center text-md-left">
                        <b style="font-family: Raleway; color: hsla(220, 100%, 80%, 1); font-size: xx-large;">Neuro Navigator</b><br/>
                        <span class="text-ignus" style="color: grey;">A game inspired by a video from <a href="https://www.youtube.com/watch?v=iV-EMA5g288" style="color: royalblue;" target="_blank">Artem Kirsanov</a></span>
                    </div>
                    <div class="pt-0 pl-2 pr-2 pb-5 pt-lg-0 pl-lg-4 pr-lg-5 pb-lg-5">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12 col-lg-6 col-xl-5">
                                    <div class="ml-2 text-ignus text-small-ignus mb-2">
                                        <span style="font-size: large" id="level-text">Level 1</span>
                                    </div>
                                    <div>
                                        <div class="hs-container-outer-ignus ">
                                            <div class="d-none d-sm-flex hs-container-left-button-ignus" onclick="ignusTheme.hsMoveLeft('#theHS', 70)">
                                                <i class="fa fa-angle-left"></i>
                                            </div>
                                            <div class="d-none d-sm-flex hs-container-right-button-ignus" onclick="ignusTheme.hsMoveRight('#theHS', 70)">
                                                <i class="fa fa-angle-right"></i>
                                            </div>
                                            <div id="theHS" class="hs-container-inner-ignus">
                                                <div class="hs-container-element-ignus">
                                                    <button class="btn-ignus btn-outline-dark-ignus" id="main-play-pause" onclick="placeCellsGame.handlePlayPause()">Pause</button>
                                                </div>
                                                <div class="hs-container-element-ignus">
                                                    <button class="btn-ignus btn-outline-dark-ignus" id="main-reset" onclick="gameGraphBasic.reset()">Restart</button>
                                                </div>
                                                <div class="hs-container-element-ignus">
                                                    <button class="btn-ignus btn-outline-dark-ignus" id="prev-level-button" onclick="gameGraphBasic.prevLevelClick()">Previous Level</button>
                                                </div>
                                                <div class="hs-container-element-ignus">
                                                    
                                                    <button class="btn-ignus btn-outline-dark-ignus" id="next-level-button" onclick="gameGraphBasic.nextLevelClick()">Next Level</button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                        
                                        
                                        <!-- <button class="btn-ignus btn-outline-dark-ignus" id="main-addplace" onclick="gameGraphBasic.handleAddPlaceCell()">Add Place Field</button> -->
                                        <!-- <span id="place-cell-colors" style="display: none">
                                            <button class="btn-ignus btn-outline-dark-ignus" style="border: 0px solid black; background: hsla(198, 100%, 70%, 0.7);" onclick="gameGraphBasic.addPlaceCell(198, [0.8, 0.5])">     &nbsp&nbsp</button>
                                            <button class="btn-ignus btn-outline-dark-ignus" style="border: 0px solid black; background: hsla(30, 100%, 70%, 0.7);" onclick="gameGraphBasic.addPlaceCell(30, [0.8, 0.5])">     &nbsp&nbsp</button>
                                            <button class="btn-ignus btn-outline-dark-ignus" style="border: 0px solid black; background: hsla(320, 100%, 70%, 0.7);" onclick="gameGraphBasic.addPlaceCell(320, [0.8, 0.5])">     &nbsp&nbsp</button>
                                        </span> -->
    
                                    </div>
                                    <div>
                                        <div class="ml-2 pt-2 text-ignus text-grey-ignus" id="time-data">Time Remaining : NA</div>
                                    </div>
                                    <div class="ml-2 text-ignus text-small-ignus mt-3" id="info-box">
                                        Move the <b style="color: hsla(198,100%,80%, 1)">place fields</b>. To move them, click/tap and drag the place fields.
                                    </div>
                                    <div id="gameSpace" style="min-height: 500px;">
                                    </div>
                                    <div class="text-ignus text-grey-ignus text-small-ignus text-center pt-4 mt-3" style="color: grey;">
                                        <span style="color: lightgrey">When the mouse reaches any of the blue place field, the blue neuron (place cell) in the mouse's brain fire and thus firing the motor neurons and other behaviors that neuron pathway intends.</span>
                                        It is your goal is to help the mouse navigate across the place to the food (reward) by modifying the position of it's place fields. When a mouse enters the place field, the corresponding neuron (blue, orange etc) is triggered, which then triggers the behavior (action) eg. Turn right, left etc.
                                    </div>
                                </div>

                                <div class="d-lg-none d-block pt-1 pb-1 pl-5"></div>
                                <div class="d-lg-none d-block pt-1 pb-1 pl-5"></div>
                                <div class="col-12 col-lg-6 col-xl-7">
                                    <div id="descriptions" class="d-none d-lg-block">
                                        <div class="container-fluid">
                                            <div class="row text-ignus" style="color: grey;">
                                                <div class="col-4 col-xl-3" style="font-size: larger;"><b>Behaviours</b><br/>       
                                                    <p style="font-size: small;">Set of actions the mouse will take
                                                    </p>
                                                </div>
                                                <div class="col-4 col-xl-3" style="font-size: larger;"><b>Neurons</b><br/>
                                                    <p style="font-size: small;">
                                                        The neurons (place cells) that are activated depending on the conditions that are determined by points in space.
                                                    </p>
                                                </div>
                                                <div class="col-4 col-xl-6" style="font-size: larger;"><b>Firings</b><br/>
                                                    <p style="font-size: small;">
                                                        The spike train for each neurons
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="neuronSpace" style="min-height: 400px;">
                                    </div>
                                    <div id="descriptions"  class="d-block d-lg-none">
                                        <div class="container-fluid">
                                            <div class="row text-ignus" style="color: grey;">
                                                <div class="col-4 col-xl-3" style="font-size: larger;"><b>Behaviours</b><br/>       
                                                    <p style="font-size: small;">Set of actions the mouse will take
                                                    </p>
                                                </div>
                                                <div class="col-4 col-xl-3" style="font-size: larger;"><b>Neurons</b><br/>
                                                    <p style="font-size: small;">
                                                        The neurons (place cells) that are activated depending on the conditions that are determined by points in space.
                                                    </p>
                                                </div>
                                                <div class="col-4 col-xl-6" style="font-size: larger;"><b>Firings</b><br/>
                                                    <p style="font-size: small;">
                                                        The spike train for each neurons
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        

                    </div>
                    
                </main>

                <div style="position: fixed; height: 100%; width: 100vw; pointer-events: none; bottom: 0px; left: 0px; z-index: 5;" id="lottie-popper"></div>


            </div>

            
			
		</div>
        <audio id="failure-sound" src="/assets/audio/error-2-126514.mp3"></audio>
        <audio id="success-sound" src="/assets/audio/scale-e6-14577.mp3"></audio>
        <audio id="activation-sound" src="/assets/audio/mixkit-game-ball-tap-2073.mp3"></audio>
        <audio id="wall-sound" src="/assets/audio/cartoon_wink_magic_sparkle-6896.mp3"></audio>


		<script type="text/javascript">		
			darkmode = true

			if (darkmode) {
				document.body.style.background = 'black'
			}

            function playSound(audio_id) {
                // Get the audio element using its ID
                const audioElement = document.getElementById(audio_id);

                // Play the audio
                audioElement.play();
            }
		</script>

        <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/prajwalsouza/viewX@latest/viewx.js"></script>  -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.6/lottie.min.js"></script>

        <script type="text/javascript" src="../JS/viewx.js"></script> 

        


        <script>

            neuronalGraph = {}
            neuronalGraph['xmin'] = -0.1
            neuronalGraph['xmax'] = 1.1
            neuronalGraph['ymin'] = -0.03
            neuronalGraph['ymax'] = 1.03


            mouseGraph = {}
            mouseGraph['font-size'] = 2

            if (window.innerWidth < 400) {
                document.getElementById('gameSpace').style.minHeight = '440px';
                document.getElementById('neuronSpace').style.minHeight = '300px'

               
                neuronalGraph['xmin'] = -0.3
                neuronalGraph['xmax'] = 0.5
                neuronalGraph['ymin'] = -0.2
                neuronalGraph['ymax'] = 0.5
                mouseGraph['font-size'] = 3
            }

            ignusTheme.baseHue = 210;
            ignusTheme.baseLightness = 80;
            ignusTheme.setUp();

            placeCellsGame = {}
            placeCellsGame.headerClick = function() {
                console.log("Hola")
            }

            placeCellsGame.anim = {}

            function loadPopperAnimation() {
                var animationData = {
                    container: document.getElementById('lottie-popper'),
                    renderer: 'svg',
                    loop: false,
                    autoplay: false, 
                    path: 'https://assets7.lottiefiles.com/packages/lf20_C51Bca6c0m.json' 
                };

                placeCellsGame.anim = bodymovin.loadAnimation(animationData);

                placeCellsGame.anim.addEventListener('complete', function() {
                    placeCellsGame.anim.hide();
                });
            }

            loadPopperAnimation();

            function playPopperAnimation() {
                placeCellsGame.anim.show();
                placeCellsGame.anim.goToAndPlay(0);
                placeCellsGame.anim.setSpeed(2)
                placeCellsGame.anim.play();
            }

            placeCellsGame.handlePlayPause = function() {
                if (gameGraphBasic.playing) {
                    gameGraphBasic.stopPlaying()
                    document.getElementById("main-play-pause").innerText = "Play"
                }
                else {
                    gameGraphBasic.startPlaying()
                    document.getElementById("main-play-pause").innerText = "Pause"
                }
            }

            
            defaultGraphOptions = {
                xmax: 1.1,
                xmin: -0.1,

                ymax: 1.03,
                ymin: -0.03,

                axislocationX: 0,
                axislocationY: 0,

                xaxislabelvisibility: 'no',
                yaxislabelvisibility: 'no',

                xaxisvisibility: 'no',
                yaxisvisibility: 'no',

                xmajorgridlabelvisibility: 'no',
                ymajorgridlabelvisibility: 'no',

                xmajorgridlinesvisibility: 'no',
                ymajorgridlinesvisibility: 'no',

                fontSize: 1.6,

                unitAspectRatio: 'yes',
                fixAxisStretchCentrally: 'yes',

                scrollZoom: "no",
            }


            
            // Code For game Graph

            gameGraphBasic = {}

            gameGraphBasic.uid = 0

            function getUiD() {
                gameGraphBasic.uid = gameGraphBasic.uid + 1
                return gameGraphBasic.uid.toString()
            }


            gameGraphBasic.setMouseLocation = function(x, y) {
                gameGraphBasic.mouse.location = [x, y]
                viewX.updatePointXY("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouse", gameGraphBasic.mouse.location[0], gameGraphBasic.mouse.location[1]);
                viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {x: gameGraphBasic.mouse.location[0] + 0.009, y: gameGraphBasic.mouse.location[1] - 0.04});
                
            }


            
            gameGraphBasic.addPlaceCell = function(placeCellColor, cellLocation) {

                placeCellColorKey = getUiD()
                gameGraphBasic.placeCells[placeCellColorKey] = {}
                gameGraphBasic.placeCells[placeCellColorKey].id = placeCellColorKey
                gameGraphBasic.placeCells[placeCellColorKey].location = cellLocation
                gameGraphBasic.placeCells[placeCellColorKey].radius = 0.1
                gameGraphBasic.placeCells[placeCellColorKey].placeCellColor = placeCellColor

                viewX.addCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1], radius: gameGraphBasic.placeCells[placeCellColorKey].radius, circlecolor: "hsla(" + placeCellColor + ", 100%, 50%, 0.1)", stroke: "transparent"});
                

                viewX.addCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle2-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1], radius: gameGraphBasic.placeCells[placeCellColorKey].radius*0.6, circlecolor: "hsla(" + placeCellColor + ", 100%, 50%, 0.1)", stroke: "transparent"});

                viewX.addCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle3-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1], radius: gameGraphBasic.placeCells[placeCellColorKey].radius*0.2, circlecolor: "hsla(" + placeCellColor + ", 100%, 50%, 0.2)", stroke: "transparent"});

                viewX.addText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Text-"  + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1] - gameGraphBasic.reward.radius - 0.07, textAlign: 'center', textcolor: "hsla(" + placeCellColor + ", 100%, 50%, 1)", text: "Place Field", fontFamily: "Nunito", fontSize: mouseGraph['font-size']});


                viewX.addPoint("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-moveKnob-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1], pointsize: 9, pointcolor: "transparent", stroke: "transparent",  draggability: "yes", runFunctionDuringDrag: "gameGraphBasic.movePlace(" + gameGraphBasic.placeCells[placeCellColorKey].id + ")"});



                // viewX.addText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCellMove-Text" + placeCellColor, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1] - 0.01, textcolor: "hsla(0, 0%, 100%, 0.4)", text: "âŠ•", fontFamily: "Nunito", fontSize: 3, textAlign: 'center', fontWeight: 'bold'});


            }


            gameGraphBasic.movePlace = function(movingPlaceID) {

                if (gameGraphBasic.placeFieldsOnlyInBeginning) {
                    if (gameGraphBasic.playing == false) {
                        placeCellColorKey = movingPlaceID
                        movingPlaceCellData = viewX.graphData['mainGameCanvas-' + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-"  + placeCellColorKey][1]

                        gameGraphBasic.placeCells[placeCellColorKey].location = [movingPlaceCellData.x, movingPlaceCellData.y]

                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});
                            
                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle2-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});

                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle3-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});

                        viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Text-"  + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1] - gameGraphBasic.reward.radius - 0.07});
                    }
                }
                else {
                    placeCellColorKey = movingPlaceID
                    movingPlaceCellData = viewX.graphData['mainGameCanvas-' + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-"  + placeCellColorKey][1]

                    gameGraphBasic.placeCells[placeCellColorKey].location = [movingPlaceCellData.x, movingPlaceCellData.y]

                    viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});
                        
                    viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle2-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});

                    viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle3-" + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1]});

                    viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Text-"  + gameGraphBasic.placeCells[placeCellColorKey].id, {x: gameGraphBasic.placeCells[placeCellColorKey].location[0], y: gameGraphBasic.placeCells[placeCellColorKey].location[1] - gameGraphBasic.reward.radius - 0.07});
                }
                
                

            }



            gameGraphBasic.firePlaceCell = function(placeCellColorKey) {
                placeCellColorFiring = gameGraphBasic.placeCells[placeCellColorKey].placeCellColor
                viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle-" + placeCellColorKey, {circlecolor: "hsla(" + placeCellColorFiring + ", 100%, 50%, 0.5)"});
                viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle2-" + placeCellColorKey, {circlecolor: "hsla(" + placeCellColorFiring + ", 100%, 50%, 0.5)"});
                viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle3-" + placeCellColorKey, {circlecolor: "hsla(" + placeCellColorFiring + ", 100%, 50%, 0.5)"});

                viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Text-" + placeCellColorKey, {text: "Firing"});

                (function(placeCellColorKeySnapshot, placeCellColorFiringSnapshot) {
                    timeOutInfo = setTimeout(function() {
                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle-" + placeCellColorKeySnapshot, {circlecolor: "hsla(" + placeCellColorFiringSnapshot + ", 100%, 50%, 0.1)"});
                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle2-" + placeCellColorKeySnapshot, {circlecolor: "hsla(" + placeCellColorFiringSnapshot + ", 100%, 50%, 0.1)"});
                        viewX.updateCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Circle3-" + placeCellColorKeySnapshot, {circlecolor: "hsla(" + placeCellColorFiringSnapshot + ", 100%, 50%, 0.2)"});
                    }, 20);
                    gameGraphBasic.timeouts.push(timeOutInfo)
                })(placeCellColorKey, placeCellColorFiring);

                (function(placeCellColorKeySnapshot, placeCellColorFiringSnapshot) {
                    timeOutInfo = setTimeout(function() {
                        viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-placeCell-Text-" + placeCellColorKeySnapshot, {text: "Place Field"});
                    }, 700);
                    gameGraphBasic.timeouts.push(timeOutInfo)
                })(placeCellColorKey, placeCellColorFiring);

 
            }



            

            gameGraphBasic.addCollider = function(name, type, colliderData) {

                gameGraphBasic.colliders[name] = {}
                gameGraphBasic.colliders[name].type = type

                if (type == 'polygon') {
                    gameGraphBasic.colliders[name].points = colliderData.points
                }
            }


            gameGraphBasic.addWall = function(name, betweenPoints, visible=true) {

                if (betweenPoints.length == 2) {
                    perpendicularSmallDisplacement = viewX.scalarMultiplyVec(0.001, viewX.unitVec(viewX.rotatedVec(viewX.subtractVec(betweenPoints[0], betweenPoints[1]), 90)))
                    perpendicularPoint1 = viewX.addVec(betweenPoints[1], perpendicularSmallDisplacement)
                    perpendicularPoint0 = viewX.addVec(betweenPoints[0], perpendicularSmallDisplacement)
                    colliderData = [betweenPoints[0], betweenPoints[1], perpendicularPoint1, perpendicularPoint0]

                    gameGraphBasic.addCollider(name, 'polygon', {points: colliderData})

                    if (visible) {
                        viewX.addLine('mainGameCanvas-' + gameGraphBasic.graphNameIndex, name, {x1: betweenPoints[0][0], y1: betweenPoints[0][1], x2: betweenPoints[1][0], y2: betweenPoints[1][1], strokewidth: 2, linecolor: 'hsla(0, 0%, 16%, 1)'})
                    }
                }
                else {
                    for (k = 0; k < betweenPoints.length - 1; k++) {
                        pointData = [betweenPoints[k], betweenPoints[k+1]]
                        perpendicularSmallDisplacement = viewX.scalarMultiplyVec(0.001, viewX.unitVec(viewX.rotatedVec(viewX.subtractVec(betweenPoints[k], betweenPoints[k + 1]), 90)))
                        perpendicularPoint1 = viewX.addVec(betweenPoints[k + 1], perpendicularSmallDisplacement)
                        perpendicularPoint0 = viewX.addVec(betweenPoints[k], perpendicularSmallDisplacement)
                        colliderData = [betweenPoints[k], betweenPoints[k + 1], perpendicularPoint1, perpendicularPoint0]

                        gameGraphBasic.addCollider(name + "#" + k, 'polygon', {points: colliderData})

                        if (visible) {
                            viewX.addLine('mainGameCanvas-' + gameGraphBasic.graphNameIndex, name + "#" + k, {x1: betweenPoints[k][0], y1: betweenPoints[k][1], x2: betweenPoints[k + 1][0], y2: betweenPoints[k + 1][1], strokewidth: 2, linecolor: 'hsla(0, 0%, 16%, 1)'})
                        }
                    }
                }
                
            }


            gameGraphBasic.setUp = function(configData) {
                
                gameGraphBasic.graphNameIndex = gameGraphBasic.graphNameIndex + 1

                if (configData.hasOwnProperty('placeFieldsOnlyInBeginning')) {
                    gameGraphBasic.placeFieldsOnlyInBeginning = configData.placeFieldsOnlyInBeginning
                }
                else {
                    gameGraphBasic.placeFieldsOnlyInBeginning = false
                }


                if (configData.hasOwnProperty('levelInfo')) {
                    document.getElementById('info-box').innerHTML = configData.levelInfo.instruction
                }
                else {
                    document.getElementById('info-box').innerHTML = "Move the <b style='color: hsla(198,100%,80%, 1)'>place fields</b>. To move them, click/tap and drag the place fields."
                }


                gameGraphBasic.placeCells = {}
                gameGraphBasic.firingGraphElements = []

                gameGraphBasic.placeCellColors = configData.neurons
                gameGraphBasic.behaviors = []

                
                gameGraphBasic.colliders = {}

                gameGraphBasic.time = configData.timer ? configData.timer.timeRemaining : null
                gameGraphBasic.timeRemaining = configData.timer ? configData.timer.timeRemaining : null
                gameGraphBasic.behaviorCellConnections = configData.brain

                document.getElementById("time-data").innerText = "Time Remaining : " + gameGraphBasic.timeRemaining


                document.getElementById("level-text").innerText = "Level " + (gameGraphBasic.currentLevel + 1)

                defaultGraphOptions['xmin'] = -0.1
                defaultGraphOptions['xmax'] = 1.1
                defaultGraphOptions['ymin'] = -0.03
                defaultGraphOptions['ymax'] = 1.03
                gameGraphBasic.graph = document.getElementById('gameSpace')
                viewX.addGraph(gameGraphBasic.graph, "mainGameCanvas-" + gameGraphBasic.graphNameIndex, defaultGraphOptions)

                rectOptions = { x: 0, y: 1, w: 1, h: 1, stroke: "hsla(0, 0%, 30%, 0.5)", strokewidth: 1, rectcolor: "hsla(190, 100%, 50%, 0)"};

                gameGraphBasic.boundaryRect = viewX.addRectangle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-boundary", rectOptions)[0];
                
                gameGraphBasic.boundaryRect.setAttribute('rx','1.1');

                gameGraphBasic.mouse = {}
                gameGraphBasic.mouse.location = configData.mouse.location
                gameGraphBasic.mouse.velocity = configData.mouse.velocity


                viewX.addPoint("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouse", {x: gameGraphBasic.mouse.location[0], y: gameGraphBasic.mouse.location[1], pointcolor: "hsla(199, 100%, 100%, 1)"});
                viewX.addText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {x: gameGraphBasic.mouse.location[0] + 0.009, y: gameGraphBasic.mouse.location[1] - 0.04, textcolor: "hsla(199, 100%, 100%, 1)", text: "Mouse", fontFamily: "Nunito", fontSize: mouseGraph['font-size']});

                gameGraphBasic.reward = {}
                gameGraphBasic.reward.location = configData.reward.location
                gameGraphBasic.reward.radius = configData.reward.radius
                viewX.addCircle("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-rewardCircle", {x: gameGraphBasic.reward.location[0], y: gameGraphBasic.reward.location[1], radius: gameGraphBasic.reward.radius, circlecolor: "hsla(249, 100%, 80%, 0.5)", stroke: "transparent"});

                viewX.addText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-rewardText", {x: gameGraphBasic.reward.location[0], y: gameGraphBasic.reward.location[1] - gameGraphBasic.reward.radius - 0.04, textcolor: "hsla(249, 100%, 80%, 1)", text: "Food", fontFamily: "Nunito", fontSize: mouseGraph['font-size'], textAlign: 'center'});




                gameGraphBasic.neuronGraph = document.getElementById('neuronSpace')
                defaultGraphOptions['xmin'] = neuronalGraph['xmin']
                defaultGraphOptions['xmax'] = neuronalGraph['xmax']
                defaultGraphOptions['ymin'] = neuronalGraph['ymin']
                defaultGraphOptions['ymax'] = neuronalGraph['ymax']
                viewX.addGraph(gameGraphBasic.neuronGraph, "neuronCanvas", defaultGraphOptions)


                for (m = 0; m < configData.behaviors.length; m++) {
                    gameGraphBasic.behaviors.push(configData.behaviors[m].name.toString())

                    behavior = configData.behaviors[m].name.toString()
                    behaviorLabel = configData.behaviors[m].label.toString()
                    viewX.addText("neuronCanvas", "neuronCanvas-behaviour-" + behavior, {x: -0.1, y: 0.7 - m*0.15, textcolor: "hsla(289, 0%, 50%, 1)", text: behaviorLabel, fontFamily: "Nunito", fontSize: mouseGraph['font-size']});

                    behaviorRect = viewX.addRectangle("neuronCanvas", "neuronCanvas-behaviour-" + behavior + "-Box", {x: -0.1 - 0.04, y: 0.7 + 0.05 - m*0.15, w: 0.2, h: 0.08, stroke: "hsla(289, 0%, 50%, 1)", rectcolor: "transparent"})[0];
                    behaviorRect.setAttribute('rx','0.5');
                }


                placementIndex = 0
                for (var key in gameGraphBasic.placeCellColors) {
                    if (gameGraphBasic.placeCellColors.hasOwnProperty(key)) {
                        placeCellColor = gameGraphBasic.placeCellColors[key]
                        neuronRect = viewX.addRectangle("neuronCanvas", "neuronCanvas-neuron-" + placeCellColor, {x: 0.2, y: 0.7 + 0.05 - placementIndex*0.15, w: 0.1, h: 0.08, stroke: "hsla(289, 0%, 50%, 0)", rectcolor: "hsla(" + placeCellColor  + ", 100%, 70%, 0.7)"})[0];
                        placementIndex = placementIndex + 1

                        neuronRect.setAttribute('rx','0.5');

                        connectToBehaviorArray = gameGraphBasic.behaviorCellConnections[placeCellColor]
                        for (bh = 0; bh < connectToBehaviorArray.length; bh++) {
                            connection = connectToBehaviorArray[bh]
                            neuronPositionIndex = gameGraphBasic.placeCellColors.indexOf(placeCellColor)
                            connectionPositionIndex = gameGraphBasic.behaviors.indexOf(connection)
                            viewX.addLine("neuronCanvas", "neuronCanvas-connecting-Line-" + placeCellColor + "-" + connection, {x1: 0.2 , y1: 0.71 - neuronPositionIndex*0.15, x2: 0.06, y2: 0.71 - connectionPositionIndex*0.15, strokewidth: 1, linecolor: "hsla(" + placeCellColor + ", 100%, 70%, 0.7)"});
                        }
                    }
                }

                // viewX.addText("neuronCanvas", "neuronCanvas-behavioursDescription", {x: 0, y: 0.95, textcolor: "hsla(289, 0%, 50%, 1)", text: "Set of actions the mouse will take", fontFamily: "Nunito", fontSize: mouseGraph['font-size']});


                cellPositions = configData.cellInitialPositions;

                gameGraphBasic.placeInitCells(cellPositions);

                gameGraphBasic.addWall('boundary-right', [[1, 0], [1, 1]], visible=false)
                gameGraphBasic.addWall('boundary-left', [[0, 0], [0, 1]], visible=false)
                gameGraphBasic.addWall('boundary-down', [[0, 0], [1, 0]], visible=false)
                gameGraphBasic.addWall('boundary-up', [[0, 1], [1, 1]], visible=false)


                for (var wallName in configData.walls) {
                    if (configData.walls.hasOwnProperty(wallName)) {
                        wall = configData.walls[wallName]
                        gameGraphBasic.addWall(wallName, wall, visible=true)
                    }
                }


                if (gameGraphBasic.placeFieldsOnlyInBeginning) {
                    gameGraphBasic.playing = false
                    document.getElementById("main-play-pause").innerText = "Play"
                }
                else {
                    gameGraphBasic.playing = true
                    document.getElementById("main-play-pause").innerText = "Pause"
                }


                gameGraphBasic.levelOptionsSetup()

                


            }

            gameGraphBasic.runGraph = function() {
                firingGraphStart = 0.5

                for (var key in gameGraphBasic.firingGraphElements) {
                    if (gameGraphBasic.firingGraphElements.hasOwnProperty(key)) {
                        gameGraphBasic.firingGraphElements[key].x1 = gameGraphBasic.firingGraphElements[key].x1 + 0.0008
                        gameGraphBasic.firingGraphElements[key].x2 = gameGraphBasic.firingGraphElements[key].x2 + 0.0008

                        viewX.updateLine("neuronCanvas", key, gameGraphBasic.firingGraphElements[key])

                        if (gameGraphBasic.firingGraphElements[key].x1 > 1) {
                            delete gameGraphBasic.firingGraphElements[key]
                            viewX.removeLine("neuronCanvas", key)
                        }
                    }
                }
            }

            gameGraphBasic.runMouse = function() {

                
                if (gameGraphBasic.playing) {

                    gameGraphBasic.runGraph()

                    if (gameGraphBasic.time != null) {
                        gameGraphBasic.time = gameGraphBasic.time - (15/1000)

                        if ( gameGraphBasic.time < 15/1000) {
                            gameGraphBasic.stopPlaying()
                            document.getElementById("main-play-pause").innerText = "Play"

                            playSound('failure-sound')
                            gameGraphBasic.reset();
                        }
                        document.getElementById("time-data").innerText = "Time Remaining : " + gameGraphBasic.time.toFixed(2)
                    }

                    stepsize = 0.02


                    for (var colliderName in gameGraphBasic.colliders) {
                        collisionData = viewX.reflectionOnCollision(gameGraphBasic.mouse.location, gameGraphBasic.mouse.velocity, gameGraphBasic.colliders[colliderName].points)
                        if (collisionData) {
                            gameGraphBasic.mouse.velocity = collisionData.velocity
                            // console.log(colliderName)

                            playSound('wall-sound')
                        }
                    }

                    newlocation = [gameGraphBasic.mouse.location[0] + stepsize*gameGraphBasic.mouse.velocity[0] , gameGraphBasic.mouse.location[1] + stepsize*gameGraphBasic.mouse.velocity[1]]
                    
                    

                    // viewX.libraryFunctions.closestIntersectionBetweenRayAndPolygon()

                    for (var key in gameGraphBasic.placeCells) {
                        if (gameGraphBasic.placeCells.hasOwnProperty(key)) {
                            distanceFromPlaceCell = viewX.distF(newlocation, gameGraphBasic.placeCells[key].location)
                            if (distanceFromPlaceCell < gameGraphBasic.placeCells[key].radius) {

                                gameGraphBasic.triggerNeuron(gameGraphBasic.placeCells[key].id, distanceFromPlaceCell)
                            }
                        }
                    }



                    if (viewX.distF(newlocation, gameGraphBasic.reward.location) < gameGraphBasic.reward.radius) {
                        playPopperAnimation()

                        playSound('success-sound')
                        // gameGraphBasic.stopPlaying()
                        // console.log(Object.keys(gameGraphBasic.levels).length)
                        gameGraphBasic.currentLevel = (gameGraphBasic.currentLevel + 1) % Object.keys(gameGraphBasic.levels).length

                        if (gameGraphBasic.maxLevel < gameGraphBasic.currentLevel) {
                            gameGraphBasic.maxLevel = gameGraphBasic.currentLevel
                        }
                        
                        gameData = {
                            currentLevel : gameGraphBasic.currentLevel,
                            maxLevel : gameGraphBasic.maxLevel
                        }

                        gameGraphBasic.writeToLocalStorage('place-cells-game', gameData)
                        gameGraphBasic.reset()
                    }
                    else {
                        gameGraphBasic.setMouseLocation(newlocation[0], newlocation[1])
                        
                    }
                    
                }
            }

            

            gameGraphBasic.fireNeuronSpike = function(placeCellColor) {
                idForSpike = "neuronCanvas-firing-Line-" + placeCellColor + "-" + getUiD()
                viewX.addLine("neuronCanvas", idForSpike, {x1: 0.3 , y1: 0.71 - 0.04 - gameGraphBasic.placeCellColors.indexOf(parseInt(placeCellColor))*0.15, x2: 0.3, y2: 0.71 - 0.04 - gameGraphBasic.placeCellColors.indexOf(parseInt(placeCellColor))*0.15 + 0.08, strokewidth: 1, linecolor: "hsla(" + placeCellColor + ", 100%, 70%, 0.4)"});


                gameGraphBasic.firingGraphElements[idForSpike] = {x1: 0.3 , y1: 0.71 - 0.04 - gameGraphBasic.placeCellColors.indexOf(parseInt(placeCellColor))*0.15, x2: 0.3, y2: 0.71 - 0.04 - gameGraphBasic.placeCellColors.indexOf(parseInt(placeCellColor))*0.15 + 0.08}
            }

            gameGraphBasic.triggerNeuron = function(placeCellColorFullKey, placeCellDistance) {

                playSound('activation-sound')
                placeCellColor = gameGraphBasic.placeCells[placeCellColorFullKey].placeCellColor
                
                fireWithinRadius = (1 - Math.random())*gameGraphBasic.placeCells[placeCellColorKey].radius

                if (placeCellDistance < fireWithinRadius) {

                    gameGraphBasic.firePlaceCell(placeCellColorFullKey)
                    gameGraphBasic.fireNeuronSpike(placeCellColor)


                    behaviors = gameGraphBasic.behaviorCellConnections[placeCellColor]

                    behaviorsExecutedString = ""
                    for (b = 0; b < behaviors.length; b++) {
                        behavior = behaviors[b]
                        
                        if (behavior == "turnLeft") {
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, 1)
                            behaviorsExecutedString = behaviorsExecutedString + "Turning Left, "
 
                        }
                        
                        if (behavior == "turnRight") {
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, -1)
                            behaviorsExecutedString = behaviorsExecutedString + "Turning Right, "


        
                        }

                        if (behavior == "turnNorth") {
                            
                            angleNeededForTurn = gameGraphBasic.angleToRotateAToGetB(gameGraphBasic.mouse.velocity, [0, 1])
                            
                            behaviorsExecutedString = behaviorsExecutedString + "Turning North, "
                            // const sign = angleForNorth > 0 ? 1 : angleForNorth < 0 ? -1 : 0;
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, angleNeededForTurn/20)
                

                        }


                        if (behavior == "turnSouth") {

                            angleNeededForTurn = gameGraphBasic.angleToRotateAToGetB(gameGraphBasic.mouse.velocity, [0, -1])
                            behaviorsExecutedString = behaviorsExecutedString + "Turning South, "
                            // const sign = angleForNorth > 0 ? 1 : angleForNorth < 0 ? -1 : 0;
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, angleNeededForTurn/20)



                        }

                        if (behavior == "turnEast") {

                            angleNeededForTurn = gameGraphBasic.angleToRotateAToGetB(gameGraphBasic.mouse.velocity, [1, 0])
                            behaviorsExecutedString = behaviorsExecutedString + "Turning East, "
                            // const sign = angleForNorth > 0 ? 1 : angleForNorth < 0 ? -1 : 0;
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, angleNeededForTurn/20)


                        }

                        if (behavior == "turnWest") {

                            angleNeededForTurn = gameGraphBasic.angleToRotateAToGetB(gameGraphBasic.mouse.velocity, [-1, 0])
                            behaviorsExecutedString = behaviorsExecutedString + "Turning West, "
                            // const sign = angleForNorth > 0 ? 1 : angleForNorth < 0 ? -1 : 0;
                            gameGraphBasic.mouse.velocity = viewX.rotatedVec(gameGraphBasic.mouse.velocity, angleNeededForTurn/20)


                        }
                        
                        
                        // if (behavior == "speedUp") {
                        //     gameGraphBasic.mouse.velocity = gameGraphBasic.mouse.velocity*1.2

                        //     viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {text: "Speeding Up"});

                        //     setTimeout(function() {
                        //         viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {text: "Mouse"});
                        //     }, 700);

                        // }
                        


                        
                        
                        
                        viewX.updateText("neuronCanvas", "neuronCanvas-behaviour-" + behavior, {textcolor: "white"});

                        viewX.updateLine("neuronCanvas", "neuronCanvas-connecting-Line-" + placeCellColor + "-" + behavior, {linecolor: "hsla(" + placeCellColor + ", 100%, 70%, 1)"});

                        viewX.updateRectangle("neuronCanvas", "neuronCanvas-neuron-" + placeCellColor, {rectcolor: "hsla(" + placeCellColor + ", 100%, 70%, 1)"});

                        (function(behaviorSnapshot, placeCellColorSnapshot) {
                            timeOutInfo = setTimeout(function() {
                                viewX.updateText("neuronCanvas", "neuronCanvas-behaviour-" + behaviorSnapshot, {textcolor: "hsla(289, 0%, 50%, 1)"});
                                viewX.updateLine("neuronCanvas", "neuronCanvas-connecting-Line-" + placeCellColorSnapshot + "-" + behaviorSnapshot, {linecolor: "hsla(" + placeCellColorSnapshot + ", 100%, 70%, 0.7)"});
                                viewX.updateRectangle("neuronCanvas", "neuronCanvas-neuron-" + placeCellColorSnapshot, {rectcolor: "hsla(" + placeCellColorSnapshot + ", 100%, 70%, 0.7)"});
                            }, 100);
                            gameGraphBasic.timeouts.push(timeOutInfo)
                        })(behavior, placeCellColor);

                    }

                    if (behaviorsExecutedString.length > 0) {
                        behaviorsExecutedString = behaviorsExecutedString.substring(0, behaviorsExecutedString.length - 2)
                    }
                    else {
                        behaviorsExecutedString = "Mouse"
                    }
                    
                    viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {text: behaviorsExecutedString});

                    timeOutInfo = setTimeout(function() {
                        viewX.updateText("mainGameCanvas-" + gameGraphBasic.graphNameIndex, "mainGame-mouseText", {text: "Mouse"});  
                    }, 700);

                    gameGraphBasic.timeouts.push(timeOutInfo)



                }
            }


            gameGraphBasic.placeInitCells = function(cellConfig) {
                for (var placeCellColorData in cellConfig) {
                    positions = cellConfig[placeCellColorData]
                    for (pindex = 0; pindex < positions.length; pindex++) {
                        gameGraphBasic.addPlaceCell(placeCellColorData, positions[pindex])
                    }
                }
                
            }

            
            gameGraphBasic.angleToRotateAToGetB = function(A, B) {
                // First calculate the dot product
                let dotProduct = A[0]*B[0] + A[1]*B[1];

                // Then calculate the magnitudes
                let magnitudeA = Math.sqrt(A[0]*A[0] + A[1]*A[1]);
                let magnitudeB = Math.sqrt(B[0]*B[0] + B[1]*B[1]);

                // Angle in radians
                let theta = Math.acos(dotProduct / (magnitudeA * magnitudeB));

                // Convert to degrees
                let angleInDegrees = theta * (180 / Math.PI);

                // Calculate the cross product to get the direction
                let crossProduct = A[0]*B[1] - A[1]*B[0];

                // If cross product is negative, B is clockwise from A so we subtract the result from 360
                if (crossProduct < 0) {
                    angleInDegrees = 360 - angleInDegrees;
                }

                if (angleInDegrees > 180) {
                    angleInDegrees = angleInDegrees - 360;
                }

                return angleInDegrees;
            }



            configD = {
                neurons : [198, 30, 320, 100],
                behaviors : [{name: 'turnNorth', label: 'Turn North'}, {name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}, {name: 'turnWest', label: 'Turn West'}],
                brain: {
                    198 : ['turnEast', 'turnSouth'],
                    30 : ['turnWest'],
                    320 : ['turnNorth'],
                    100: ['turnSouth']
                },
                mouse: {
                    location: [0.2, 0.8],
                    velocity: [0.2, 0]
                },
                reward: {
                    location: [0.9, 0.2],
                    radius: 0.07
                },
                cellInitialPositions : {
                    198: [
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1], 
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1]
                    ],
                    30: [
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1], 
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1], 
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1]
                    ],
                    320: [
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1]
                    ],
                    100: [
                        [0.1 + 0.8*Math.random(), 0.8*Math.random() + 0.1]
                    ]
                },
                walls: {
                    'wall1': [[0.8, 0.8], [0.8, 0]],
                    'wall2': [[0.8, 0.8], [0.3, 0.8]],
                    'wall3': [[0.3, 0.8], [0.3, 0.2]]
                }
            }






            setInterval(gameGraphBasic.runMouse, 30)

            gameGraphBasic.startPlaying = function() {
                gameGraphBasic.playing = true

                if (gameGraphBasic.placeFieldsOnlyInBeginning) {
                    for (var placeCellColorKey in gameGraphBasic.placeCells) {
                        if (gameGraphBasic.placeCells.hasOwnProperty(placeCellColorKey)) {
                            viewX.graphData["mainGameCanvas-" + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-" + gameGraphBasic.placeCells[placeCellColorKey].id][0].style.cursor = "auto";
                            viewX.graphData["mainGameCanvas-" + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-" + gameGraphBasic.placeCells[placeCellColorKey].id][0].style.pointerEvents = "none";

                            
                        }
                    }

                    document.getElementById("main-play-pause").style.display = "none"

                }
            }

            gameGraphBasic.stopPlaying = function() {
                gameGraphBasic.playing = false

                if (gameGraphBasic.placeFieldsOnlyInBeginning) {
                    for (var placeCellColorKey in gameGraphBasic.placeCells) {
                        if (gameGraphBasic.placeCells.hasOwnProperty(placeCellColorKey)) {
                            viewX.graphData["mainGameCanvas-" + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-" + gameGraphBasic.placeCells[placeCellColorKey].id][0].style.cursor = "move";
                            viewX.graphData["mainGameCanvas-" + gameGraphBasic.graphNameIndex].pointData["mainGame-placeCell-moveKnob-" + gameGraphBasic.placeCells[placeCellColorKey].id][0].style.pointerEvents = "auto";
                        }
                    }

                }
            }

            gameGraphBasic.reset = function() {
                viewX.removeGraph("mainGameCanvas-" + gameGraphBasic.graphNameIndex)
                viewX.removeGraph("neuronCanvas")

                for (var key in gameGraphBasic.timeouts) {
                    if (gameGraphBasic.timeouts.hasOwnProperty(key)) {
                        clearTimeout(gameGraphBasic.timeouts[key])
                    }
                }

                gameGraphBasic.timeouts = []
                gameGraphBasic.setUp(gameGraphBasic.levels[gameGraphBasic.currentLevel])
                document.getElementById("main-play-pause").style.display = "inline-block"
            }

            gameGraphBasic.timeouts = []

            gameGraphBasic.handleAddPlaceCell = function() {
                if (document.getElementById("place-cell-colors").style.display == "inline-block") {
                    document.getElementById("place-cell-colors").style.display = "none"
                    document.getElementById('main-addplace').innerText = "Add Place Field"
                }
                else {
                    document.getElementById("place-cell-colors").style.display = "inline-block"
                    document.getElementById('main-addplace').innerText = "Hide Field Options"
                }
            }

            
            gameGraphBasic.graphNameIndex = 0

            
            
            gameGraphBasic.writeToLocalStorage = function(key, data) {
                try {
                    const serializedData = JSON.stringify(data);
                    localStorage.setItem(key, serializedData);
                } catch (e) {
                    console.error('Error saving to local storage', e);
                }
            }


             gameGraphBasic.readFromLocalStorage = function(key) {
                try {
                    const serializedData = localStorage.getItem(key);
                    return JSON.parse(serializedData);
                } catch (e) {
                    console.error('Error reading from local storage', e);
                    return null;
                }
            }


            gameGraphBasic.resetLocalStorage = function(key) {
                try {
                    localStorage.removeItem(key);
                } catch (e) {
                    console.error('Error removing from local storage', e);
                }
            }


            
            
            gameData = gameGraphBasic.readFromLocalStorage('place-cells-game')


            if (gameData != null) {
                gameGraphBasic.currentLevel = gameData.currentLevel
                if (gameData.maxLevel != null) {
                    gameGraphBasic.maxLevel = gameData.maxLevel
                }
                else {
                    gameGraphBasic.maxLevel = gameData.currentLevel
                }
            }
            else {
                gameGraphBasic.currentLevel = 0
                gameGraphBasic.maxLevel = 0
            }

            gameGraphBasic.levelOptionsSetup = function() {
                if (gameGraphBasic.currentLevel == gameGraphBasic.maxLevel) {
                    document.getElementById("next-level-button").style.display = "none"
                }
                else {
                    document.getElementById("next-level-button").style.display = "inline-block"
                }

                if (gameGraphBasic.currentLevel == 0) {
                    document.getElementById("prev-level-button").style.display = "none"
                }
                else {
                    document.getElementById("prev-level-button").style.display = "inline-block"
                }
            }


            gameGraphBasic.prevLevelClick = function() {
                gameGraphBasic.currentLevel = gameGraphBasic.currentLevel - 1
                gameGraphBasic.reset()
            }

            gameGraphBasic.nextLevelClick = function() {
                gameGraphBasic.currentLevel = (gameGraphBasic.currentLevel + 1) % Object.keys(gameGraphBasic.levels).length
                gameGraphBasic.reset()
            }

            gameGraphBasic.levels = {
                0 : {
                    neurons : [198, 30],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}],
                    brain: {
                        198 : ['turnEast'],
                        30: ['turnSouth']
                    },
                    mouse: {
                        location: [0.2, 0.8],
                        velocity: [0.2, 0]
                    },
                    reward: {
                        location: [0.7, 0.2],
                        radius: 0.07
                    },
                    cellInitialPositions : {
                        30: [
                            [0.8, 0.8], 
                            [0.4, 0.5]
                        ],
                        198: [
                            [0.9, 0.6]
                        ]

                    },
                    walls: {},
                    timer: {
                        timeRemaining: 20
                    }
                },
                1 : {
                    neurons : [198],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}],
                    brain: {
                        198 : ['turnEast', 'turnSouth'],
                    },
                    mouse: {
                        location: [0.2, 0.8],
                        velocity: [0.2, 0]
                    },
                    reward: {
                        location: [0.9, 0.3],
                        radius: 0.05
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.76]
                        ]

                    },
                    walls: {
                        'wall-1': [[0.8, 0.7], [0.8, 0.2]]
                    },
                    timer: {
                        timeRemaining: 12
                    }
                },
                2 : {
                    neurons : [198, 40, 310],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}, {name: 'turnWest', label: 'Turn West'}],
                    brain: {
                        198 : ['turnEast'],
                        40 : ['turnWest'],
                        310: ['turnSouth']
                    },
                    mouse: {
                        location: [0.1, 0.95],
                        velocity: [0.15, -0.1]
                    },
                    reward: {
                        location: [0.05, 0.85],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.76],
                        ],
                        310: [  
                            [0.3, 0.1],
                        ],
                        40: [  
                            [0.1, 0.1],
                        ]

                    },
                    walls: {
                        'wall-1': [[0, 1], [0.9, 0.1]]
                    },
                    timer: {
                        timeRemaining: 20
                    }
                },
                3 : {
                    neurons : [198, 40, 310],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}, {name: 'turnWest', label: 'Turn West'}],
                    brain: {
                        198 : ['turnEast'],
                        40 : ['turnWest'],
                        310: ['turnSouth']
                    },
                    mouse: {
                        location: [0.01, 0.05],
                        velocity: [0, -0.2]
                    },
                    reward: {
                        location: [0.98, 0.95],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.76],
                        ],
                        310: [  
                            [0.7, 0.5],
                        ],
                        40: [  
                            [0.1, 0.8],
                        ]

                    },
                    walls: {
                        'wall-1': [[0.2, 0.8], [1, 0.8]],
                        'wall-2': [[0, 0.2], [0.8, 0.2]]
                    },
                    timer: {
                        timeRemaining: 35
                    }
                },
                4 : {
                    neurons : [198, 310],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}],
                    brain: {
                        198 : ['turnEast'],
                        310: ['turnSouth']
                    },
                    mouse: {
                        location: [0.9, 0.1],
                        velocity: [0.15, 0.15]
                    },
                    reward: {
                        location: [0.5, 0.5],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.76],
                        ],
                        310: [  
                            [0.3, 0.1],
                        ]

                    },
                    walls: {
                        'wall-1': [[0.8, 0.6], [0.8, 0.1]],
                        'spiral-wall-1': [[0.4, 0.4], [0.4, 0.6], [0.6, 0.6], [0.6, 0.25], [0.25, 0.25], [0.25, 0.8], [0.8, 0.8]]
                    },
                    timer: {
                        timeRemaining: 32
                    }
                },
                7 : {
                    neurons : [198, 310],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}],
                    brain: {
                        198 : ['turnEast'],
                        310: ['turnSouth']
                    },
                    mouse: {
                        location: [0.9, 0.1],
                        velocity: [0.15, 0.15]
                    },
                    reward: {
                        location: [0.5, 0.5],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.76],
                        ],
                        310: [  
                            [0.3, 0.1],
                        ]

                    },
                    walls: {
                        'spiral-wall-1': [[0.4, 0.4], [0.4, 0.6], [0.6, 0.6], [0.6, 0.25], [0.25, 0.25], [0.25, 0.8], [0.8, 0.8], [0.8, 0.1]]
                    },
                    timer: {
                        timeRemaining: 35
                    }
                },
                5 : {
                    neurons : [198, 310],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}],
                    brain: {
                        198 : ['turnEast'],
                        310: ['turnSouth']
                    },
                    mouse: {
                        location: [0.1, 0.8],
                        velocity: [0.2, 0]
                    },
                    reward: {
                        location: [0.5, 0.5],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.3],
                        ],
                        310: [  
                            [0.8, 0.8],
                        ]
                    },
                    timer: {
                        timeRemaining: 35
                    },
                    levelInfo : {
                        instruction: "Moving <b style='color: hsla(198,100%,80%, 1)'>place fields</b> is only possible in the <b style='color: orange;'>beginning</b> of this level."
                    },
                    placeFieldsOnlyInBeginning: true
                },
                6 : {
                    neurons : [198, 310, 30, 120],
                    behaviors : [{name: 'turnSouth', label: 'Turn South'}, {name: 'turnEast', label: 'Turn East'}, {name: 'turnWest', label: 'Turn West'}, {name: 'turnNorth', label: 'Turn North'}],
                    brain: {
                        198 : ['turnEast'],
                        310: ['turnSouth', 'turnWest'],
                        30: ['turnNorth'],
                        120: ['turnWest']
                    },
                    mouse: {
                        location: [0.1, 0.8],
                        velocity: [0.2, 0]
                    },
                    reward: {
                        location: [0.5, 0.5],
                        radius: 0.03
                    },
                    cellInitialPositions : {
                        198: [
                            [0.4, 0.3],
                        ],
                        310: [  
                            [0.8, 0.8],
                        ],
                        30: [  
                            [0.1, 0.2],
                        ],
                        120: [  
                            [0.6, 0.9],
                        ]
                    },
                    walls: {
                        'wall-1': [[0.8, 0.8], [0.8, 0.2]],
                        'wall-2': [[0.8, 0.8], [0.2, 0.8]],
                        'wall-3': [[0.2, 0.8], [0.2, 0.2]],
                        'wall-4': [[0.2, 0.2], [0.6, 0.2]]
                    },
                    timer: {
                        timeRemaining: 30
                    },
                    levelInfo : {
                        instruction: "Moving <b style='color: hsla(198,100%,80%, 1)'>place fields</b> is only possible in the <b style='color: orange;'>beginning</b> of this level."
                    },
                    placeFieldsOnlyInBeginning: true
                },
            }



            gameGraphBasic.setUp(gameGraphBasic.levels[gameGraphBasic.currentLevel]);

        </script>
    </body>
</html>